<h3 class="ui-bar ui-bar-a">Geocoding, Reverse Geocoding</h3>
<div id="map_canvas"></div>
<div data-role="tabs" id="tabs">
  <div data-role="navbar">
    <ul>
      <li><a id="pre_geocoding" href="#one" data-ajax="false">Geocoding</a></li>
      <li><a id="reverse" href="#two" data-ajax="false">Reverse geocoding</a></li>
    </ul>
  </div>
  <div id="one" class="ui-body-d ui-content">
    <table width="100%">
      <tr>
        <td width="70%">
          <input type="text" name="textinput-hide" id="geocoder_input" placeholder="Address" value="Kyoto, Japan">
        </td>
        <td width="30%">
          <button id="geocoding" class="ui-btn ui-btn-inline ui-icon-search ui-btn-icon-left"></button>
        </td>
      </tr>
    </table>
    <h4 class="ui-bar ui-bar-a">with jQuery</h4>
    <code class="prettyprint">var request = {
  'address': $("#geocoder_input").val()
};
map.geocode(request, function(results) {
  if (results.length) {
    var result = results[0];
    var position = result.position; 
    
    map.addMarker({
      'position': position,
      'title':  JSON.stringify(result.position)
    }, function(marker) {
      
      map.animateCamera({
        'target': position,
        'zoom': 17
      }, function() {
        marker.showInfoWindow();
      });
      
    });
  } else {
    alert("Not found");
  }
});</code>
  </div>
  <div id="two">
    <h4 class="ui-bar ui-bar-a">with jQuery</h4>
    <code class="prettyprint">marker.on(plugin.google.maps.event.MARKER_DRAG_END, function(marker) {
  var request = {
    'position': latLng
  };
  map.geocode(request, function(results) {
    if (results.length) {
      var result = results[0];
      var address = [
        result.subThoroughfare || "",
        result.thoroughfare || "",
        result.locality || "",
        result.adminArea || "",
        result.postalCode || "",
        result.country || ""].join(" ");
      
      marker.setTitle(address);
      marker.setPosition(result.position);
      marker.showInfoWindow();
    } else {
      alert("Not found");
    }
  });
});</code>
    
  </div>
</div>
<script type="text/javascript">

function onPageLoaded(map) {
  map.setDiv($("#map_canvas")[0]);
  $("#pre_geocoding").click(function() {
    map.clear();
  });
  $("#geocoding").click(function() {
    geocoding(map);
  });
  $("#reverse").click(function() {
    map.clear();
    whereIsMarker(map);
  });
}
function whereIsMarker(map) {
  map.clear();
  const GOOGLE = new plugin.google.maps.LatLng(37.422858, -122.085065);

  map.moveCamera({
    'target': GOOGLE,
    'zoom': 7
  });
  map.addMarker({
    'position': GOOGLE,
    'draggable': true,
    'title': 'Drag me!'
  }, function(marker) {
    marker.showInfoWindow();
  
    marker.on(plugin.google.maps.event.MARKER_DRAG_START, function(marker) {
      marker.hideInfoWindow();
    });
    marker.on(plugin.google.maps.event.MARKER_DRAG_END, function(marker) {
      marker.getPosition(function(latLng) {
        reverseGeocoding(map, marker, latLng);
      });
    });
  });
}

function reverseGeocoding(map, marker, latLng) {
  var request = {
    'position': latLng
  };
  map.geocode(request, function(results) {
    if (results.length) {
      var result = results[0];
      var address = [
        result.subThoroughfare || "",
        result.thoroughfare || "",
        result.locality || "",
        result.adminArea || "",
        result.postalCode || "",
        result.country || ""].join(" ");
      
      marker.setTitle(address);
      marker.setPosition(result.position);
      marker.showInfoWindow();
    } else {
      alert("Not found");
    }
  });
}

function geocoding(map) {
  map.clear();
  var request = {
    'address': $("#geocoder_input").val()
  };
  map.geocode(request, function(results) {
    if (results.length) {
      var result = results[0];
      var position = result.position; 
      
      map.addMarker({
        'position': position,
        'title':  JSON.stringify(result.position)
      }, function(marker) {
        
        map.animateCamera({
          'target': position,
          'zoom': 17
        }, function() {
          marker.showInfoWindow();
        });
        
      });
    } else {
      alert("Not found");
    }
  });
}
</script>
